{"version":3,"sources":["o0Game.js"],"names":["o0","require","o0CC","GroupIndex","Default","Food","Head","Body","PlayGround","UI","Tag","Ground","Player","Chainsaw","Others","module","exports","Connection","onClose","self","State","Disconnect","Connect","Waiting","Game","address","window","undefined","location","hostname","webSocket","id","state","players","host","playerNumber","onStart","onReceiving","onHostChange","log","WebSocket","err","onopen","event","connectionState","console","onmessage","processData","onerror","onclose","data","send","random","Random","serverData","JSON","parse","setState","jsonData","stringify","setTimeout","readyState","OPEN"],"mappings":"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","file":"o0Game.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\Script\\o0Lib","sourcesContent":["var o0 = require('o0');\r\nvar o0CC = require('o0CC');\r\n//for this game\r\n\r\nvar GroupIndex = {\r\n    Default : 0,\r\n    Food : 1,\r\n    Head : 2,\r\n    Body : 3,\r\n    PlayGround : 4,\r\n    UI : 5,\r\n}\r\n\r\nvar Tag = {\r\n    Default : 0,\r\n    Ground : 1,\r\n    Player : 2,\r\n    Chainsaw : 3,\r\n    PlayGround : 4,\r\n    Others : 5,\r\n}\r\n\r\nmodule.exports = {\r\n    GroupIndex,\r\n    Tag,\r\n    Connection: class{\r\n        constructor(onClose) {\r\n            var self = this;\r\n            this.State = {\r\n                Disconnect : 0,\r\n                Connect : 1,\r\n                Waiting : 2,\r\n                Game : 3}\r\n            this.address = 'localhost:8080';\r\n            if(window!=undefined && window.location!=undefined&&window.location.hostname!=undefined){\r\n                this.address = window.location.hostname+':8080';\r\n            }\r\n            this.webSocket = null;\r\n            this.id = null;\r\n            this.state = this.State.Disconnect;\r\n            this.players = null;\r\n            this.host = null;\r\n            this.playerNumber = 2;\r\n\r\n            this.onStart = null;\r\n            this.onReceiving = null;\r\n            this.onClose = onClose;\r\n            this.onHostChange = null;\r\n            \r\n            o0CC.log('Connection');\r\n            o0CC.log(this.address);\r\n            try {\r\n                this.webSocket = new WebSocket('ws://'+this.address);\r\n            }catch(err){\r\n                o0CC.log('new connection fail: '+err);\r\n                self.onClose();\r\n                return;\r\n            }\r\n            this.webSocket.onopen = function (event) {\r\n                this.connectionState = self.State.Connect;\r\n                console.log(\"Send Text WS was opened.\");\r\n            };\r\n            this.webSocket.onmessage = function (event) {\r\n                self.processData(event);\r\n            }\r\n            this.webSocket.onerror = function (event) {\r\n                self.onClose();\r\n                console.log(\"Send Text fired an error\");\r\n            };\r\n            this.webSocket.onclose = function (event) {\r\n                self.onClose();\r\n                console.log(\"WebSocket instance closed.\");\r\n            };\r\n            //this.test();\r\n        }\r\n        setState(state,data){\r\n            this.state = state;\r\n            if(state == this.State.Connect){\r\n                this.send({'maxPlayer':this.playerNumber, 'joinCondition':0});\r\n            }else if (state == this.State.Game){\r\n                this.random = new o0.Random(data['seed']);\r\n                this.players = data['players'];\r\n                //this.players.sort(function(a,b){ return a - b });\r\n                o0CC.log(\"Game Init\");\r\n                this.onStart();\r\n            }\r\n        }\r\n        processData(event){\r\n            if(typeof(event.data) != \"string\"){\r\n                return;\r\n            }\r\n    \r\n            //cc.log(event.data);\r\n            var serverData = JSON.parse(event.data);\r\n            var id = serverData['id'];\r\n            var state = serverData['state'];\r\n            var data = serverData['data'];\r\n            var host = serverData['host'];\r\n            if(this.id == null){\r\n                if(id != null){\r\n                    this.id = id;\r\n                }else{\r\n                    return;\r\n                }\r\n            }\r\n            if(this.id == id && state != null){\r\n                this.setState(state,serverData);\r\n                //this.test();\r\n            }\r\n            if(host!=null){\r\n                if(this.host != host){\r\n                    this.host = host;\r\n                    this.onHostChange(host);\r\n                }\r\n            }\r\n            if(this.state == this.State.Game && data != null && id != null){\r\n                this.onReceiving(id,data);\r\n            }\r\n        }\r\n        send(data){\r\n            var jsonData = JSON.stringify(data);\r\n            //cc.log(jsonData);\r\n            var self = this;\r\n            setTimeout(function () {\r\n                if (self.webSocket !=null && self.webSocket.readyState === WebSocket.OPEN) {\r\n                    self.webSocket.send(jsonData);\r\n                }\r\n                else {\r\n                    console.log(\"WebSocket instance wasn't ready...\");\r\n                }\r\n            }, 3);\r\n        }\r\n    },\r\n};\r\n"]}